<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Photos AU</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js" integrity="sha384-7+zCNj/IqJ95wo16oMtfsKbZ9ccEh31eOz1HGyDuCQ6wgnyJNSYdrPa03rtR1zdB" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js" integrity="sha384-QJHtvGhmr9XOIpI6YVutG+2QOK9T+ZnN4kzFN1RtK3zEFEIsxhlmWl5/YESvpZ13" crossorigin="anonymous"></script>
    </head>
    <body>

        <!-- HEADER -->
        <div data-th-replace="helpers/header :: header"></div>

        <nav aria-label="breadcrumb" style="margin:10px;">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Photos</li>
            </ol>
        </nav>

        <!-- BODY -->
        <h2 id='listPhotos'>LISTADO DE FOTOS</h2>
        <br>
        <table class="table table-stripped" border='1'>
            <thead>
                <tr>
                    <th>id</th>
                    <th>title</th>
                    <th>url</th>
                    <th>status</th>
                    <th>lastTime</th>
                    <th>Buttons</th>

                </tr>
            </thead>
            <tbody id="table-photos">
                
            </tbody>
        </table>
        <button onclick="location.href = '/photosAU/add'">Add Photo</button>

        <!-- FOOTER -->
        <div data-th-replace="helpers/footer :: footer"></div>
    </body>

    <script>

        const API_URL = "http://localhost:8080";

        window.onload = function () {
            if (document.getElementById("listPhotos") !== null) {
                showPhotos();
            } else if (document.getElementById("add") !== null) {
                const formA = document.getElementById('form');
                formA.addEventListener("submit", (e) => {
                    e.preventDefault();
                    sendFormAdd();
                });
            }


        };

        function showPhotos() {
            const HTMLResponse = document.querySelector('#table-photos');
            
            const photosLista = async () => {
                const response = await fetch(`${API_URL}/AU/photosAU`);
                const photos = await response.json();
                console.log(photos);
            };
            
            photosLista();

            fetch(`${API_URL}/AU/photosAU`)
                    .then((response) => response.json())
                    .then((photos) => {
                        photos.forEach((photo) => {

                            let elementTr = document.createElement('tr');
                            let elementTd1 = document.createElement('td');
                            let elementTd2 = document.createElement('td');
                            let elementTd3 = document.createElement('td');
                            let elementTd4 = document.createElement('td');
                            let elementTd5 = document.createElement('td');
                            let elementTd6 = document.createElement('td');

                            elementTd1.innerHTML = `${photo.id}`;
                            elementTd2.innerHTML = `${photo.title}`;
                            elementTd3.innerHTML = `${photo.url}`;
                            elementTd4.innerHTML = `${photo.status}`;
                            elementTd5.innerHTML = `${photo.lastTime}`;
                            elementTd6.innerHTML = `<a href="/AU/photosAU/edit/${photo.id}">Editar</a>
                                            <a href="/AU/photosAU/delete/${photo.id}">Borrar</a>`;

                            elementTr.appendChild(elementTd1);
                            elementTr.appendChild(elementTd2);
                            elementTr.appendChild(elementTd3);
                            elementTr.appendChild(elementTd4);
                            elementTr.appendChild(elementTd5);
                            elementTr.appendChild(elementTd6);

                            HTMLResponse.appendChild(elementTr);

                        });
                    });
        }

        function sendFormAdd() {
            let photo = document.getElementById('uploadInput').value;
            let titlePhoto = document.getElementById('nombreInput').value;

            const params = {
                photo: photo,
                title: titlePhoto
            };

            const options = {
                method : 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(params)
            };

            fetch(`${API_URL}/AU/photosAU`, options)
                    .then((response) => response.json())
                    .then((response) => {
                        if (response !== null) {
                            alert('Save Correctly');
                            console.log(response);
                        } else {
                            console.log(response);
                            throw new Error('We have problem Houston!');
                        }
                    })
                    .catch((exception) => {
                        console.log(exception);
                    });
        }


    </script>
</html>
